---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Yanyu Wu
  - Ziyi Liu
  - Hechen Zhang
thanks: "Code and data are available at: https://github.com/HechenZ123/Cause-of-Deaths-in-Alberta.git"
date: 'today'
date-format: 'long'
abstract: "We examined the distribution of the top 30 causes of death for each year between 2001 and 2022 in Alberta, Canada. The conifer model and negative binomial regression were used to analyse the long-term leading causes of death and the sudden emergence of specific causes of death. According to our findings, negative binomial regression improves our ability to predict outcomes when the data is too spread out by fitting the data more accurately. The results could not only help policymakers design more effective preventive measures to reduce mortality from these conditions, but also help researchers and policymakers make more precise decisions."
format: pdf
toc: true
editor: visual
render:
  latex_engine: xelatex
number-sections: true
bibliography: references.bib
---
\newpage

# 1.0 Introduction

The mortality rate, often referred to as the death rate, represents an approximation of the fraction of a population that dies within a given time frame [@porta2014dictionary]. Mortality rates can serve as a crucial indicator of a populationâ€™s health status, and it also reveals the impact of diseases and other health-related issues over a period of time. This paper explores the leading causes of death in Alberta for crafting effective public health strategies and policies and understanding the most significant health threats affecting a population for researchers[@datasetCOD]. By identifying the main causes of mortality, health authorities can prioritise research funding towards diseases and conditions that have the highest impact on community health and lifespan [@vargas2019assessment]. 

As discussed in the data section, we used data from Service Alberta [@datasetCOD] on the leading causes of deaths, in which the five most significant causes in 2022 were analysed. These five causes are Organic dementia, Other causes not clearly defined, COVID-19, and Cancers of the trachea, bronchus, and lungs. It was noted that, among the examples mentioned, the negative binomial regression is more accurate compared to the Poisson model, while Poisson regression is prone to errors.

## 1.1 Importing Important Packages.
In this analysis, we employ a range of R [@citeR] packages tailored for data cleaning, transformation, analysis, and reporting. `Tidyverse` by @tidyverse is used for data wrangling, `janitor` package by @janitor is used for data cleaning operations, and `knitr` by @knitr for data presentation in data tables.The following code section aims at importing the important packages that are essential for examining the missing values in the data set.We run the model in R @citeR using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`. For comprehensive mixed effects model analysis, we leverage the `broom.mixed` package [@broommixed], which extends the `broom` package functionalities to mixed models, facilitating the extraction, tidying, and representation of model outputs. Furthermore, the `modelsummary` package [@modelsummary] provides tools for creating customizable summary tables of model results, enhancing the interpretability and dissemination of statistical findings. By calculating the LOO-CV scores for different models with `loo` [@loo], we could compare them based on their out-of-sample predictive accuracy. Lower values of LOOIC indicate better model performance. The following code sections aim to import these crucial packages, essential for conducting a thorough analysis and addressing the research questions at hand, while ensuring data integrity and transparent reporting of results. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Set up libraries
library(broom.mixed)
library(tidyverse)
library(janitor)
library(knitr)
library(modelsummary)
library(rstanarm)
library(loo)
```

# 2.0 Data {#sec-data}

Our data is of leading causes of death (@fig-dataset-overview), from @datasetCOD.

## 2.1 Data Sources
The Alberta Government created the dataset.The official website of the Government of Alberta provides a single platform for services and information pertaining to Alberta, Canada. It provides information on government news, jobs, social services, health, and education, making it an essential tool for both locals and tourists to be updated about provincial issues.

## 2.2 Variables
Order by total number of deaths and a ranking of the top 30 causes of death in Alberta each year.Our table lists the top eight causes of death in Alberta in 2022. Examine each variable in detail:
*Year*: This denotes the data gathering year, which for all entries is 2022.
*Cause*: This represents the medical condition or event that led to death. The causes listed are shown in @fig-dataset-overview:
`Organic dementia`
`All other forms of chronic...`, 
`Other ill-defined and unknown...`, 
`COVID-19, virus identified`, 
`Malignant neoplasms of the trachea, bronchus, and lung`, 
`Acute myocardial infarction`, 
`Accidental poisoning by and...`, 
`Other chronic obstructive pulmonary diseases`, 
*Ranking*: This is a ranking by the number of deaths caused by each disease, with 1 being the highest.
*Deaths*: The number of deaths attributed to each cause.
*Year*: Indicates the number of years in which data was collected for that reason.

```{r}
#| label: fig-dataset-overview
#| fig-cap: Top-teight causes of death in Alberta in 2022
#| echo: false
#| warning: false
alberta_cod <- read_csv(here::here("data/analysis_data/analysis_data.csv"))
alberta_cod |>
  filter(
    calendar_year == 2022,
    ranking <= 8
  ) |>
  mutate(total_deaths = format(total_deaths, big.mark = ",")) |>
  kable(
    col.names = c("Year", "Cause", "Ranking", "Deaths", "Years"),
    align = c("l", "r", "r", "r", "r"),
    digits = 0, booktabs = TRUE, linesep = ""
  )
```


## 2.3 Data Description
It accurately reflects health issues specific to the region, but this information is somewhat limited by location. Health policies vary from country to country, and in some regions and countries, health coverage may be less developed than in others, and low-income groups may not be able to afford basic medical care, which increases their risk of chronic diseases and other health problems. The main types of employment in a city also have an impact on health; In an industrial city, some jobs may require exposure to hazardous substances or strenuous physical labor, which increases the likelihood of developing occupational diseases. Risks associated with the workplace may lead to an increase in diseases such as cardiovascular and respiratory diseases. In addition, communities with higher levels of education and economic prosperity generally have stronger social support systems, which are critical for disease prevention.

The demographics of a society also have a significant impact on cause-of-death data. Age distribution is important because certain age groups are more susceptible to certain diseases. For example, young children may be more susceptible to infectious diseases, while older people may be more susceptible to degenerative and chronic diseases. Given that certain medical conditions are more common in one sex than the other - men may have higher rates of heart disease, while women may have higher rates of certain cancers - the sex ratio may also have an impact on causes of death. In addition, differences in the ethnic makeup of the population may be related to lifestyle choices, genetic makeup, and disease risk. For example, genetic factors may contribute to the higher incidence of certain chronic diseases in particular ethnic groups. Elucidating how resources are allocated to public health problems therefore requires a thorough understanding and study of population characteristics.

We can also see that in the data table @fig-dataset-overview for 2022, COVID-19 ranks fourth, with 1,547 deaths. Alberta's cause-of-death data proves that the coronavirus pandemic is one of the most serious public health crises of the early 21st century, with global implications. This figure not only speaks to the outbreak's death rate, but also suggests that the region's health care system may be under strain. The COVID-19 pandemic has disrupted the distribution of deaths from previously common causes, which may include some chronic diseases that have long held the top spot, such as cancer and heart disease, even though it was not the leading cause of death in the years shown in the table.

As large datasets are difficult to observe, this report will analyze only specific aspects. The original dataset contains eight different causes of death. Only the first five causes will be analyzed in this paper.

For simplicity we restrict ourselves to the five most common causes of death in 2022 of those that have been present every year.
```{r}
#| label: tbl-top-five
#| tbl-cap: Top Five Leading causes of death in 2022
#| echo: false
#| warning: false
# Look up the five most common causes of death in 2022
alberta_cod_top_five <-
  alberta_cod |>
  filter(
     calendar_year == 2022
  ) |>
  slice_max(order_by = desc(ranking), n = 5) |>
  pull(cause)

alberta_cod <-
  alberta_cod |>
  filter(cause %in% alberta_cod_top_five)

head(alberta_cod_top_five)
```


# 3.0 Model

## 3.1 Model setup:

In analyzing the association between the total number of deaths and significant causes of death, we used two different regression models to predict, namely the Poisson distribution and the binomial distribution. Both the Poisson and binomial distribution models are regression models used to analyze count data, primarily for finding the relationship between independent variables (predictors) and dependent variables (count outcomes). In regression models, the independent variables are independent, while the dependent variables depend on the independent variables. In our model, the independent variables are the different causes of death mentioned in the table, such as COVID-19, malignant neoplasms, organic dementia, etc. These variables are used to predict or explain the number of deaths. The dependent variable is the number of deaths in Alberta from 2001 to 2022. This variable is the response variable in the model, and its count is the result to be predicted or explained.

Using the Poisson distribution has different advantages and disadvantages in this study. The Poisson model is simple in form, with fewer parameters, making it easy to understand and explain, and because of its simplicity, this model has a faster computation speed and is easy to implement. The Poisson distribution has a solid theoretical foundation for modeling the number of times an event occurs. It assumes that the average frequency of events occurring over a certain time or space is constant, and the occurrence of individual events is independent. At the same time, the Poisson distribution is a regression model specifically used for analyzing count data (where the response variable is non-negative). In our study, our response variable is the number of deaths, which is definitely a positive number, making the Poisson distribution suitable for our research. However, it also has some shortcomings, such as the problem of overdispersion; if the actual data show that the variance is greater than the mean, the Poisson model may not be applicable, and the model's predictive effect will worsen.

Regarding the negative binomial distribution, its advantage is that it includes an additional parameter to model overdispersion, making it more suitable for data where the variance is greater than the mean. Compared to the Poisson model, the negative binomial model offers more flexibility to fit various data, especially those that exhibit significant overdispersion or clustering. The negative binomial model includes an extra parameter to account for overdispersion, allowing the variance to exceed the mean. In our study, this model also attempts to link death counts with various causes but is more flexible in handling data variability. However, compared to the Poisson distribution, the negative binomial model is more complex, involving more parameters, which may lead to difficulties in model explanation and communication. The negative binomial model typically requires more computational resources, so it may not be as efficient as the Poisson model on large datasets.

In our data situation, the negative binomial model seems more appropriate than the Poisson model, possibly due to overdispersion in the data. Therefore, in analyzing causes of death (such as COVID-19, malignant neoplasms, organic dementia, etc.), choosing the negative binomial model may provide more accurate estimates.
 

Poisson model:
\begin{align} 
y_i|\lambda_i &\sim \mbox{Poisson}(\lambda_i) \\
log(\lambda_i) & = \beta_0 + \beta_1 \cdot x_i\\
\beta_0 &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\end{align}

Negative binomial model:
\begin{align} 
y_i|\lambda_i, \theta &\sim \mbox{NegativeBinomial}(\mu_i, \theta) \\
log(\mu_i) & = \beta_0 + \beta_1 \cdot x_i\\
\beta_0 &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\end{align}

From this formula, we can consider $y_i$ to be the total number of deaths, with the i-th observation representing the cause of death. $\beta_0$ represents the intercept, which is the expected log count of the response variable when all predictor variables are held at zero. The intercepts of the two models are similar. Each cause of death has a corresponding coefficient $\beta_i$, indicating the change in the expected log count of deaths for each unit increase in the predictor variable (i.e., the presence of the cause of death). A negative coefficient suggests that the presence of that cause is associated with a decrease in the death count relative to the baseline level. The intercept $\beta_0$ and the slope $\beta_i$ both follow a prior distribution that is normally distributed with a mean of 0 and a standard deviation of 2.5.


```{r}
#| echo: false
#| eval: true
#| warning: false

cause_of_death_alberta_poisson <-
  readRDS(file = here::here("models/cause_of_death_alberta_poisson.rds"))

cause_of_death_alberta_neg_binomial <-
  readRDS(file = here::here("models/cause_of_death_alberta_neg_binomial.rds"))
```

## 3.2 Model justification

Based on the models discussed above, it is challenging to determine whether each cause of death has a positive or negative correlation with the total number of deaths, as the leading cause of death changes each year. The specific impact of these changes must be determined by the coefficient of each leading cause of death to decide whether the correlation is positive or negative. According to Table 1, from 2001 to 2022, organic dementia shows an upward trend, indicating that organic dementia is positively correlated with the total number of deaths. In the upcoming model results section, we will elaborate in detail on the association between each cause of death and the total number of deaths.

Based on our discussion in the model set-up section, the negative binomial distribution seems more suitable for our research objectives than the Poisson distribution. The Poisson model assumes that the mean and variance are equal, but in the real world, they are rarely equal. The negative binomial distribution incorporates a dispersion parameter, making the predictions more accurate.


# Results
```{r}
#| label: fig-planes
#| fig-cap:  Annual number of deaths for the top-five causes in 2022, since 2001, for Alberta, Canada
#| echo: false
#| warning: false
#| message: false
alberta_cod |>
  ggplot(aes(x = calendar_year, y = total_deaths, color = cause)) +
  geom_line() +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  labs(x = "Year", y = "Annual number of deaths in Alberta") +
  facet_wrap(vars(cause), dir = "v", ncol = 1) +
  theme(legend.position = "none")
```

```{r}
#| label: fig-summary_table
#| echo: false
#| tbl-cap: Summary by cause of the number of yearly deaths in Alberta, Canada
#| warning: false
#| message: false
# Calculate summary statistics for total_deaths
summary_stats <- data.frame(
  Min = min(alberta_cod$total_deaths, na.rm = TRUE),
  Mean = mean(alberta_cod$total_deaths, na.rm = TRUE),
  Max = max(alberta_cod$total_deaths, na.rm = TRUE),
  SD = sd(alberta_cod$total_deaths, na.rm = TRUE),
  Var = var(alberta_cod$total_deaths, na.rm = TRUE),
  N = sum(!is.na(alberta_cod$total_deaths))
)

# Use kable from knitr to create a table
kable(summary_stats)
```

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Modeling the most prevalent cause of deaths in Alberta, 2001-2022"
#| warning: false
modelsummary(
  list(
    "Poisson" = cause_of_death_alberta_poisson,
    "Negative binomial" = cause_of_death_alberta_neg_binomial
  )
)

```


# Discussion

## Addressing Public Health Challenges in Alberta: Strategies for Health Policy and Social Regulation

Based on the top five causes of death in Alberta, it is imperative that we consider initiatives to improve health policy and social regulation to address health challenges, prioritizing public health issues. Looking at the data, given the significant impact of Covid-19 on mortality rates, it is crucial to continue efforts to implement public health interventions. This includes increasing mass vaccination activities, continuing to promote mask-wearing and social distancing measures, and enhancing testing and contact tracing capabilities. Furthermore, it is essential to ensure that the healthcare system has sufficient capacity to handle an increase in cases. It is worth noting that in the coming years, due to the passage of several years since the virus initially emerged, Covid-19 may not continue to be such a significant cause of death, as the virus gradually becomes less virulent or severe [@talic2021effectiveness].
Implementing policies for cancer prevention and control can help reduce mortality from malignant neoplasms of the trachea, bronchus, and lung. This may include implementing tobacco control measures, such as increasing tobacco product taxes, comprehensive smoking cessation programs, and restricting tobacco advertising and promotion. Additionally, promoting healthy lifestyles, early cancer screening programs, and providing high-quality cancer treatment services are also crucial [@eastman2023nci].

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Comparing posterior prediction checks for Poisson and negative binomial models"
#| fig-subcap: ["Poisson model", "Negative binomial model"]

pp_check(cause_of_death_alberta_poisson) +
  theme(legend.position = "bottom")

pp_check(cause_of_death_alberta_neg_binomial) +
  theme(legend.position = "bottom")
```




```{r}
#| echo: false
#| eval: true
#| message: true
#| warning: true
#| label: fig-LOOIC
#| fig-cap: "Comparing the LOO-CV scores"


poisson <- loo(cause_of_death_alberta_poisson, cores = 1)
neg_binomial <- loo(cause_of_death_alberta_neg_binomial, cores = 1)

loo_compare(poisson, neg_binomial)
```



\newpage


# References